jQuery(document).ready(function(b){function B(){b("#eo_occurrence_includes").val(u.join(",\r\n"));b("#eo_occurrence_excludes").val(x.join(",\r\n"))}function t(){var g=!b("#HWSEvent_rec").prop("checked");b(".reoccurence .event-date :input").attr("disabled",g);b(".reoccurence .event-date :input").toggleClass("ui-state-disabled",g);g=!b("#eo_allday:checkbox").attr("checked");b(".eo_time").attr("disabled",!g);b(".eo_time").toggleClass("ui-state-disabled",!g);switch(b("#HWSEventInput_Req").val()){case "once":case "custom":b("#HWSEvent_freq").val("1");
b(".reocurrence_row").hide();b("#dayofweekrepeat").show();b("#dayofmonthrepeat").show();b(".reocurrence_row").attr("disabled",true);break;case "weekly":b(".reocurrence_row :input").attr("disabled",false);b("#HWSEvent_freq").val()>1?b("#recpan").text(n.weeks):b("#recpan").text(n.week);b(".reocurrence_row").fadeIn(700);b("#dayofweekrepeat").fadeIn(700);b("#dayofweekrepeat :input").attr("disabled",false);b("#dayofweekrepeat").buttonset("enable");b("#dayofmonthrepeat").hide();b("#dayofmonthrepeat :radio").attr("disabled",
true);break;case "monthly":b(".reocurrence_row :input").attr("disabled",false);b("#HWSEvent_freq").val()>1?b("#recpan").text(n.months):b("#recpan").text(n.month);b(".reocurrence_row").fadeIn(700);b("#dayofmonthrepeat").fadeIn(700);b("#dayofmonthrepeat :input").attr("disabled",false);b("#dayofweekrepeat").hide();b("#dayofweekrepeat :input").attr("disabled",true);break;case "daily":b(".reocurrence_row :input").attr("disabled",false);b(".reocurrence_row").fadeIn(700);b("#HWSEvent_freq").val()>1?b("#recpan").text(n.days):
b("#recpan").text(n.day);b("#dayofweekrepeat").hide();b("#dayofweekrepeat :input").attr("disabled",true);b("#dayofmonthrepeat").hide();b("#dayofmonthrepeat :radio").attr("disabled",true);break;case "yearly":b(".reocurrence_row :input").attr("disabled",false);b(".reocurrence_row").fadeIn(700);b("#HWSEvent_freq").val()>1?b("#recpan").text(n.years):b("#recpan").text(n.year);b("#dayofweekrepeat").hide();b("#dayofweekrepeat :input").attr("disabled",true);b("#dayofmonthrepeat").hide();b("#dayofmonthrepeat :radio").attr("disabled",
true);break}b("#venue_select").val()===null&&b("tr.venue_row").hide();p()}function p(){if(b("#HWSEventInput_Req").val()=="once")b("#event_summary").html("This event will be a one-time event");else{var g=b("#from_date").datepicker("getDate"),k=EO_Ajax_Event.locale.weekDay,w=new Array("SU","MO","TU","WE","TH","FR","SA"),v={monthNamesShort:EO_Ajax_Event.locale.monthAbbrev,dayNamesMin:EO_Ajax_Event.locale.dayAbbrev,monthNames:EO_Ajax_Event.locale.monthNames};b("#HWSEventInput_Req :selected").text();var h=
parseInt(b("#HWSEvent_freq").val()),m=n.summary+" ";switch(b("#HWSEventInput_Req").val()){case "custom":case "daily":m+=h>1?sprintf(n.dayPlural,h):n.daySingle;break;case "weekly":m+=h>1?sprintf(n.weekPlural,h):n.weekSingle;h=b("#dayofweekrepeat :checkbox:checked");if(h.length==0){h=g.getDay();b("#dayofweekrepeat :checkbox[value='"+w[h]+"']").attr("checked",true)}h=b("#dayofweekrepeat :checkbox:checked");h.each(function(o){if(o==0)m=m+" "+k[w.indexOf(b(this).val())];if(o>0)m=m+", "+k[w.indexOf(b(this).val())]});
break;case "monthly":m+=h>1?sprintf(n.monthPlural,h):n.monthSingle;if(b("#dayofmonthrepeat :radio:checked").val()=="BYMONTHDAY=")m=m+" "+g.getDate()+a(g);else{h=g.getDay()%7;g=parseInt(Math.floor((g.getDate()-1)/7));m=m+" "+n.occurrence[g]+" "+k[h]}break;case "yearly":m+=h>1?sprintf(n.yearPlural,h):n.yearSingle;m=m+" "+b.datepicker.formatDate("MM d",g,v)+a(g);break}g=b("#recend").datepicker("getDate");if(g!=null)m=m+" "+n.until+" "+b.datepicker.formatDate("MM d'"+a(g)+"' yy",g,v);b("#event_summary").html(m)}}
function a(g){return["th","st","nd","rd"][3<g.getDate()&&g.getDate()<20?0:Math.min(g.getDate()%10,4)%4]}function c(){x=[];u=[];B();f(eo_viewing_month[0],eo_viewing_month[1],{});y.datepicker("refresh")}function e(g){g=b.datepicker.formatDate("yy-mm-dd",g);if(d(g)[0])return[true,"ui-state-active",""];return[true,"ui-state-disabled",""]}function d(g){if(b.inArray(g,r)>-1){g=b.inArray(g,x);return g>-1?[false,g]:[true,-1]}else{g=b.inArray(g,u);return g>-1?[true,g]:[false,-1]}}function f(g,k){r=[];eo_viewing_month=
[g,k];var w=b("#HWSEventInput_Req").val(),v=parseInt(b("#HWSEvent_freq").val()),h=b("#from_date").datepicker("getDate"),m=b("#recend").datepicker("getDate");k-=1;var o=new Date(g,k,1),z=new Date(new Date(g,k+1,1)-1);if(!(m<o||h>z)){switch(w){case "once":case "custom":g=b.datepicker.formatDate("yy-mm-dd",h);r.push(g);return;case "daily":if(h<o){var C=Math.abs((o-h)/864E5)-1;C%=v}else C=parseInt(h.getDate());k=v;var G=[],E=new Date(o);E.setDate(o.getDate()+(C-1));G.push(E);break;case "weekly":var q=
o.getDay();q=b("#dayofweekrepeat :checkbox:checked");var J=new Array("SU","MO","TU","WE","TH","FR","SA");G=[];q.each(function(I){I=J.indexOf(b(this).val());E=new Date(h);E.setDate(h.getDate()+(I-h.getDay()+7)%7);if(E<o){C=Math.abs((o-h)/864E5);C-=C%(v*7);E.setDate(E.getDate()+C)}G.push(E)});k=7*v;break;case "monthly":if(((g-h.getFullYear())*12+k-(h.getMonth()+1))%v!=0)return;if(b('input[name="eo_input[schedule_meta]"]:checked').val()=="BYMONTHDAY="){var F=h.getDate();z=z.getDate();if(F<=z)q=new Date(g,
k,F)}else{g=Math.ceil(h.getDate()/7);F=h.getDay();if(g>=5){q=z.getDay();z=z.getDate()+(F-q-7)%7}else{q=o.getDay();z=(F-q+7)%7+(g-1)*7+1}q=new Date(o);q.setDate(z)}if(q<=m){g=b.datepicker.formatDate("yy-mm-dd",q);r.push(g)}return;case "yearly":if((g-h.getFullYear())%v!=0)return;z=new Date(g,h.getMonth(),h.getDate());if(k==h.getMonth()&&z.getMonth()==h.getMonth()){q=new Date(h);q.setYear(g);if(q<=m){g=b.datepicker.formatDate("yy-mm-dd",q);r.push(g)}}return;default:return}for(F in G)for(q=new Date(G[F]);q<=
z&&q<=m;){g=b.datepicker.formatDate("yy-mm-dd",q);r.push(g);q.setDate(q.getDate()+k)}}}function i(g){var k=d(g);if(k[0]){k=k[1];k>-1?j(k):s(g)}else{k=k[1];k>-1?A(k):l(g)}B()}function l(g){b.inArray(g,u)<0&&u.push(g)}function j(g){u.splice(g,1)}function s(g){b.inArray(g,x)<0&&x.push(g)}function A(g){x.splice(g,1)}var r=[],u,x;if(b("#eo_occurrence_includes").length>0){u=b("#eo_occurrence_includes").val().split(",");x=b("#eo_occurrence_excludes").val().split(",")}b(document).ready(function(){b.widget("ui.combobox",
{_create:function(){var g,k=this.element.hide(),w=k.children(":selected");w=w.val()?w.text():"";k=b("<span>").addClass("ui-combobox eo-venue-input").insertAfter(k);g=b("<input>").appendTo(k).val(w).addClass("ui-combobox-input").autocomplete({delay:0,minLength:0,source:function(v,h){b.getJSON(EO_Ajax_Event.ajaxurl+"?callback=?&action=eo-search-venue",v,function(m){m=b.map(m,function(o){o.label=o.name;return o});h(m)})},select:function(v,h){if(b("tr.venue_row").length>0){h.item.term_id==0?b("tr.venue_row").hide():
b("tr.venue_row").show();b("#eventorganiser_event_detail tr.eo-add-new-venue").hide();eo_initialize_map(h.item.venue_lat,h.item.venue_lng)}b("#venue_select").removeAttr("selected");b("#venue_select").val(h.item.term_id)}}).addClass("ui-widget-content ui-corner-left");g.data("autocomplete")._renderItem=function(v,h){if(h.term_id==0)return b("<li></li>").data("item.autocomplete",h).append("<a>"+h.label+"</a>").appendTo(v);var m=[h.venue_address,h.venue_postal,h.venue_country];m=b.grep(m,function(o){return o});
return b("<li></li>").data("item.autocomplete",h).append("<a>"+h.label+"</br> <span style='font-size: 0.8em'><em>"+m.join(", ")+"</span></em></a>").appendTo(v)};k=b("<span>").addClass("eo-venue-combobox-buttons").appendTo(k);b("<a style='vertical-align: top;margin: 0px -1px;padding: 0px;height: 21px;'>").attr("title","Show All Items").appendTo(k).button({icons:{primary:"ui-icon-triangle-1-s"},text:false}).removeClass("ui-corner-all").addClass("ui-corner-right ui-combobox-toggle ui-combobox-button").click(function(){if(g.autocomplete("widget").is(":visible"))g.autocomplete("close");
else{b(this).blur();g.autocomplete("search","");g.focus()}});"event"==pagenow&&b("<a style='vertical-align: top;margin: 0px -1px;padding: 0px;height: 21px;'>").attr("title","Create New Venue").appendTo(k).button({icons:{primary:"ui-icon-plus"},text:false}).removeClass("ui-corner-all").addClass("ui-corner-right add-new-venue ui-combobox-button").click(function(){b("#eventorganiser_event_detail tr.eo-add-new-venue").show();b("tr.venue_row").show();b("#venue_select").removeAttr("selected").val(0);b(".eo-venue-combobox-select").hide();
b(".eo-venue-input input").val("");eo_initialize_map(0,0);b(this).blur()})}});b("#venue_select").combobox()});b(".eo-add-new-venue-cancel").click(function(g){g.preventDefault();b(".eo-venue-combobox-select").show();b(".eo-add-new-venue input").val("");b("#eventorganiser_event_detail tr.eo-add-new-venue").hide()});var n=EO_Ajax_Event.locale;if(b("#eventorganiser_detail #from_date, #eventorganiser_detail #to_date").length>0){var H=b("#eventorganiser_detail #from_date, #eventorganiser_detail #to_date").datepicker({dateFormat:EO_Ajax_Event.format,
changeMonth:true,changeYear:true,monthNamesShort:EO_Ajax_Event.locale.monthAbbrev,dayNamesMin:EO_Ajax_Event.locale.dayAbbrev,firstDay:parseInt(EO_Ajax_Event.startday),buttonImage:"images/ui-icon-calendar.png",onSelect:function(g){var k=this.id=="from_date"?"minDate":"maxDate",w=b(this).data("datepicker");g=b.datepicker.parseDate(w.settings.dateFormat||b.datepicker._defaults.dateFormat,g,w.settings);H.not(this).datepicker("option",k,g);this.id=="from_date"&&b("#recend").datepicker("option","minDate",
g);c();t()}});b("#recend").datepicker({dateFormat:EO_Ajax_Event.format,monthNamesShort:EO_Ajax_Event.locale.monthAbbrev,dayNamesMin:EO_Ajax_Event.locale.dayAbbrev,changeMonth:true,changeYear:true,firstDay:parseInt(EO_Ajax_Event.startday)});b("#HWSEvent_time, #HWSEvent_time2").timepicker({showPeriodLabels:false,hourText:EO_Ajax_Event.locale.hour,minuteText:EO_Ajax_Event.locale.minute});b("#HWSEvent_rec").click(function(){t()});b(".reoccurence .event-date :input, .onetime .event-date :input").not(".eo_time").change(function(){t();
b(this).attr("id")!="eo_allday"&&c()});t();var D=!b(this).prop("checked");b(".reoccurence .event-date :input").attr("disabled",D);b(".reoccurence .event-date :input").toggleClass("ui-state-disabled",D)}b(".eo_occurrence_toogle").click(function(g){g.preventDefault();g.stopPropagation();y.toggle()});D=new Date;f(D.getFullYear(),D.getMonth()+1,{});var y=b("#eo_occurrence_datepicker");y.length>0&&y.datepicker({dateFormat:"yy-mm-dd",onSelect:i,beforeShowDay:e,onChangeMonthYear:f,changeMonth:true,changeYear:true,
monthNamesShort:EO_Ajax_Event.locale.monthAbbrev,dayNamesMin:EO_Ajax_Event.locale.dayAbbrev,firstDay:parseInt(EO_Ajax_Event.startday)}).hide();b("html").click(function(){y.hide()});y.find(".ui-datepicker-inline").click(function(g){if(!g)g=window.event;g.cancelBubble=true;g.stopPropagation&&g.stopPropagation()})});
var sprintf=function(){function b(p){return Object.prototype.toString.call(p).slice(8,-1).toLowerCase()}function B(p,a){for(var c=[];a>0;c[--a]=p);return c.join("")}var t=function(){t.cache.hasOwnProperty(arguments[0])||(t.cache[arguments[0]]=t.parse(arguments[0]));return t.format.call(null,t.cache[arguments[0]],arguments)};t.format=function(p,a){var c=1,e=p.length,d="",f=[],i,l,j,s;for(i=0;i<e;i++){d=b(p[i]);if(d==="string")f.push(p[i]);else if(d==="array"){j=p[i];if(j[2]){d=a[c];for(l=0;l<j[2].length;l++){if(!d.hasOwnProperty(j[2][l]))throw sprintf('[sprintf] property "%s" does not exist',
j[2][l]);d=d[j[2][l]]}}else d=j[1]?a[j[1]]:a[c++];if(/[^s]/.test(j[8])&&b(d)!="number")throw sprintf("[sprintf] expecting number but found %s",b(d));switch(j[8]){case "b":d=d.toString(2);break;case "c":d=String.fromCharCode(d);break;case "d":d=parseInt(d,10);break;case "e":d=j[7]?d.toExponential(j[7]):d.toExponential();break;case "f":d=j[7]?parseFloat(d).toFixed(j[7]):parseFloat(d);break;case "o":d=d.toString(8);break;case "s":d=(d=String(d))&&j[7]?d.substring(0,j[7]):d;break;case "u":d=Math.abs(d);
break;case "x":d=d.toString(16);break;case "X":d=d.toString(16).toUpperCase();break}d=/[def]/.test(j[8])&&j[3]&&d>=0?"+"+d:d;l=j[4]?j[4]=="0"?"0":j[4].charAt(1):" ";s=j[6]-String(d).length;l=j[6]?B(l,s):"";f.push(j[5]?d+l:l+d)}}return f.join("")};t.cache={};t.parse=function(p){p=p;for(var a=[],c=[],e=0;p;){if((a=/^[^\x25]+/.exec(p))!==null)c.push(a[0]);else if((a=/^\x25{2}/.exec(p))!==null)c.push("%");else if((a=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(p))!==
null){if(a[2]){e|=1;var d=[],f=a[2],i=[];if((i=/^([a-z_][a-z_\d]*)/i.exec(f))!==null)for(d.push(i[1]);(f=f.substring(i[0].length))!=="";)if((i=/^\.([a-z_][a-z_\d]*)/i.exec(f))!==null)d.push(i[1]);else if((i=/^\[(\d+)\]/.exec(f))!==null)d.push(i[1]);else throw"[sprintf] huh?";else throw"[sprintf] huh?";a[2]=d}else e|=2;if(e===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";c.push(a)}else throw"[sprintf] huh?";p=p.substring(a[0].length)}return c};return t}(),vsprintf=
function(b,B){B.unshift(b);return sprintf.apply(null,B)};
(function(b){function B(){this._curInst=null;this._disabledInputs=[];this._inDialog=this._timepickerShowing=false;this._dialogClass="ui-timepicker-dialog";this._mainDivId="ui-timepicker-div";this._inlineClass="ui-timepicker-inline";this._currentClass="ui-timepicker-current";this._dayOverClass="ui-timepicker-days-cell-over";this.regional=[];this.regional[""]={hourText:"Hour",minuteText:"Minute",amPmText:["AM","PM"],closeButtonText:"Done",nowButtonText:"Now",deselectButtonText:"Deselect"};this._defaults=
{showOn:"focus",button:null,showAnim:"fadeIn",showOptions:{},appendText:"",beforeShow:null,onSelect:null,onClose:null,timeSeparator:":",periodSeparator:" ",showPeriod:false,showPeriodLabels:true,showLeadingZero:true,showMinutesLeadingZero:true,altField:"",defaultTime:"now",myPosition:"left top",atPosition:"left bottom",onHourShow:null,onMinuteShow:null,hours:{starts:0,ends:23},minutes:{starts:0,ends:55,interval:5},rows:4,showHours:true,showMinutes:true,optionalMinutes:false,showCloseButton:false,
showNowButton:false,showDeselectButton:false};b.extend(this._defaults,this.regional[""]);this.tpDiv=b('<div id="'+this._mainDivId+'" class="ui-timepicker ui-widget ui-helper-clearfix ui-corner-all " style="display: none"></div>')}function t(a,c){b.extend(a,c);for(var e in c)if(c[e]==null||c[e]==undefined)a[e]=c[e];return a}b.extend(b.ui,{timepicker:{version:"0.3.1"}});var p=(new Date).getTime();b.extend(B.prototype,{markerClassName:"hasTimepicker",log:function(){},_widgetTimepicker:function(){return this.tpDiv},
setDefaults:function(a){t(this._defaults,a||{});return this},_attachTimepicker:function(a,c){var e=null;for(var d in this._defaults){var f=a.getAttribute("time:"+d);if(f){e=e||{};try{e[d]=eval(f)}catch(i){e[d]=f}}}d=a.nodeName.toLowerCase();f=d=="div"||d=="span";if(!a.id){this.uuid+=1;a.id="tp"+this.uuid}var l=this._newInst(b(a),f);l.settings=b.extend({},c||{},e||{});if(d=="input"){this._connectTimepicker(a,l);this._setTimeFromField(l)}else f&&this._inlineTimepicker(a,l)},_newInst:function(a,c){return{id:a[0].id.replace(/([^A-Za-z0-9_-])/g,
"\\\\$1"),input:a,inline:c,tpDiv:!c?this.tpDiv:b('<div class="'+this._inlineClass+' ui-timepicker ui-widget  ui-helper-clearfix"></div>')}},_connectTimepicker:function(a,c){var e=b(a);c.append=b([]);c.trigger=b([]);if(!e.hasClass(this.markerClassName)){this._attachments(e,c);e.addClass(this.markerClassName).keydown(this._doKeyDown).keyup(this._doKeyUp).bind("setData.timepicker",function(d,f,i){c.settings[f]=i}).bind("getData.timepicker",function(d,f){return this._get(c,f)});b.data(a,"timepicker",
c)}},_doKeyDown:function(a){var c=b.timepicker._getInst(a.target),e=true;c._keyEvent=true;if(b.timepicker._timepickerShowing)switch(a.keyCode){case 9:b.timepicker._hideTimepicker();e=false;break;case 13:b.timepicker._updateSelectedValue(c);b.timepicker._hideTimepicker();return false;case 27:b.timepicker._hideTimepicker();break;default:e=false}else if(a.keyCode==36&&a.ctrlKey)b.timepicker._showTimepicker(this);else e=false;if(e){a.preventDefault();a.stopPropagation()}},_doKeyUp:function(a){a=b.timepicker._getInst(a.target);
b.timepicker._setTimeFromField(a);b.timepicker._updateTimepicker(a)},_attachments:function(a,c){var e=this._get(c,"appendText"),d=this._get(c,"isRTL");c.append&&c.append.remove();if(e){c.append=b('<span class="'+this._appendClass+'">'+e+"</span>");a[d?"before":"after"](c.append)}a.unbind("focus.timepicker",this._showTimepicker);a.unbind("click.timepicker",this._adjustZIndex);c.trigger&&c.trigger.remove();e=this._get(c,"showOn");if(e=="focus"||e=="both"){a.bind("focus.timepicker",this._showTimepicker);
a.bind("click.timepicker",this._adjustZIndex)}if(e=="button"||e=="both"){e=this._get(c,"button");b(e).bind("click.timepicker",function(){if(b.timepicker._timepickerShowing&&b.timepicker._lastInput==a[0])b.timepicker._hideTimepicker();else c.input.is(":disabled")||b.timepicker._showTimepicker(a[0]);return false})}},_inlineTimepicker:function(a,c){var e=b(a);if(!e.hasClass(this.markerClassName)){e.addClass(this.markerClassName).append(c.tpDiv).bind("setData.timepicker",function(d,f,i){c.settings[f]=
i}).bind("getData.timepicker",function(d,f){return this._get(c,f)});b.data(a,"timepicker",c);this._setTimeFromField(c);this._updateTimepicker(c);c.tpDiv.show()}},_adjustZIndex:function(a){a=a.target||a;b.timepicker._getInst(a).tpDiv.css("zIndex",b.timepicker._getZIndex(a)+1)},_showTimepicker:function(a){a=a.target||a;if(a.nodeName.toLowerCase()!="input")a=b("input",a.parentNode)[0];if(!(b.timepicker._isDisabledTimepicker(a)||b.timepicker._lastInput==a)){b.timepicker._hideTimepicker();var c=b.timepicker._getInst(a);
b.timepicker._curInst&&b.timepicker._curInst!=c&&b.timepicker._curInst.tpDiv.stop(true,true);var e=b.timepicker._get(c,"beforeShow");t(c.settings,e?e.apply(a,[a,c]):{});c.lastVal=null;b.timepicker._lastInput=a;b.timepicker._setTimeFromField(c);if(b.timepicker._inDialog)a.value="";if(!b.timepicker._pos){b.timepicker._pos=b.timepicker._findPos(a);b.timepicker._pos[1]+=a.offsetHeight}var d=false;b(a).parents().each(function(){d|=b(this).css("position")=="fixed";return!d});if(d&&b.browser.opera){b.timepicker._pos[0]-=
document.documentElement.scrollLeft;b.timepicker._pos[1]-=document.documentElement.scrollTop}e={left:b.timepicker._pos[0],top:b.timepicker._pos[1]};b.timepicker._pos=null;c.tpDiv.css({position:"absolute",display:"block",top:"-1000px"});b.timepicker._updateTimepicker(c);if(!c.inline&&typeof b.ui.position=="object"){c.tpDiv.position({of:c.input,my:b.timepicker._get(c,"myPosition"),at:b.timepicker._get(c,"atPosition"),collision:"flip"});e=c.tpDiv.offset();b.timepicker._pos=[e.top,e.left]}c._hoursClicked=
false;c._minutesClicked=false;e=b.timepicker._checkOffset(c,e,d);c.tpDiv.css({position:b.timepicker._inDialog&&b.blockUI?"static":d?"fixed":"absolute",display:"none",left:e.left+"px",top:e.top+"px"});if(!c.inline){e=b.timepicker._get(c,"showAnim");var f=b.timepicker._get(c,"duration"),i=function(){b.timepicker._timepickerShowing=true;var l=b.timepicker._getBorders(c.tpDiv);c.tpDiv.find("iframe.ui-timepicker-cover").css({left:-l[0],top:-l[1],width:c.tpDiv.outerWidth(),height:c.tpDiv.outerHeight()})};
b.timepicker._adjustZIndex(a);b.effects&&b.effects[e]?c.tpDiv.show(e,b.timepicker._get(c,"showOptions"),f,i):c.tpDiv[e||"show"](e?f:null,i);if(!e||!f)i();c.input.is(":visible")&&!c.input.is(":disabled")&&c.input.focus();b.timepicker._curInst=c}}},_getZIndex:function(a){a=b(a);for(var c;a.length&&a[0]!==document;){c=a.css("position");if(c==="absolute"||c==="relative"||c==="fixed"){c=parseInt(a.css("zIndex"),10);if(!isNaN(c)&&c!==0)return c}a=a.parent()}},_refreshTimepicker:function(a){(a=this._getInst(a))&&
this._updateTimepicker(a)},_updateTimepicker:function(a){a.tpDiv.empty().append(this._generateHTML(a));this._rebindDialogEvents(a)},_rebindDialogEvents:function(a){var c=b.timepicker._getBorders(a.tpDiv),e=this;a.tpDiv.find("iframe.ui-timepicker-cover").css({left:-c[0],top:-c[1],width:a.tpDiv.outerWidth(),height:a.tpDiv.outerHeight()}).end().find(".ui-timepicker-minute-cell").unbind().bind("click",{fromDoubleClick:false},b.proxy(b.timepicker.selectMinutes,this)).bind("dblclick",{fromDoubleClick:true},
b.proxy(b.timepicker.selectMinutes,this)).end().find(".ui-timepicker-hour-cell").unbind().bind("click",{fromDoubleClick:false},b.proxy(b.timepicker.selectHours,this)).bind("dblclick",{fromDoubleClick:true},b.proxy(b.timepicker.selectHours,this)).end().find(".ui-timepicker td a").unbind().bind("mouseout",function(){b(this).removeClass("ui-state-hover");this.className.indexOf("ui-timepicker-prev")!=-1&&b(this).removeClass("ui-timepicker-prev-hover");this.className.indexOf("ui-timepicker-next")!=-1&&
b(this).removeClass("ui-timepicker-next-hover")}).bind("mouseover",function(){if(!e._isDisabledTimepicker(a.inline?a.tpDiv.parent()[0]:a.input[0])){b(this).parents(".ui-timepicker-calendar").find("a").removeClass("ui-state-hover");b(this).addClass("ui-state-hover");this.className.indexOf("ui-timepicker-prev")!=-1&&b(this).addClass("ui-timepicker-prev-hover");this.className.indexOf("ui-timepicker-next")!=-1&&b(this).addClass("ui-timepicker-next-hover")}}).end().find("."+this._dayOverClass+" a").trigger("mouseover").end().find(".ui-timepicker-now").bind("click",
function(d){b.timepicker.selectNow(d)}).end().find(".ui-timepicker-deselect").bind("click",function(d){b.timepicker.deselectTime(d)}).end().find(".ui-timepicker-close").bind("click",function(){b.timepicker._hideTimepicker()}).end()},_generateHTML:function(a){var c,e,d,f,i=this._get(a,"showPeriod")==true,l=this._get(a,"showPeriodLabels")==true,j=this._get(a,"showLeadingZero")==true;e=this._get(a,"showHours")==true;var s=this._get(a,"showMinutes")==true,A=this._get(a,"amPmText"),r=this._get(a,"rows"),
u=0,x=0,n=f=0,H=0,D=0,y=Array(),g=this._get(a,"hours");c=null;var k=0;d=this._get(a,"hourText");var w=this._get(a,"showCloseButton"),v=this._get(a,"closeButtonText"),h=this._get(a,"showNowButton"),m=this._get(a,"nowButtonText"),o=this._get(a,"showDeselectButton"),z=this._get(a,"deselectButtonText"),C=w||h||o;for(c=g.starts;c<=g.ends;c++)y.push(c);c=Math.ceil(y.length/r);if(l){for(k=0;k<y.length;k++)if(y[k]<12)f++;else n++;k=0;u=Math.floor(f/y.length*r);x=Math.floor(n/y.length*r);if(r!=u+x)if(f&&(!n||
!u||x&&f/u>=n/x))u++;else x++;H=Math.min(u,1);D=u+1;c=Math.ceil(Math.max(f/u,n/x))}f='<table class="ui-timepicker-table ui-widget-content ui-corner-all"><tr>';if(e){f+='<td class="ui-timepicker-hours"><div class="ui-timepicker-title ui-widget-header ui-helper-clearfix ui-corner-all">'+d+'</div><table class="ui-timepicker">';for(e=1;e<=r;e++){f+="<tr>";if(e==H&&l)f+='<th rowspan="'+u.toString()+'" class="periods" scope="row">'+A[0]+"</th>";if(e==D&&l)f+='<th rowspan="'+x.toString()+'" class="periods" scope="row">'+
A[1]+"</th>";for(d=1;d<=c;d++)if(l&&e<D&&y[k]>=12)f+=this._generateHTMLHourCell(a,undefined,i,j);else{f+=this._generateHTMLHourCell(a,y[k],i,j);k++}f+="</tr>"}f+="</tr></table></td>"}if(s){f+='<td class="ui-timepicker-minutes">';f+=this._generateHTMLMinutes(a);f+="</td>"}f+="</tr>";if(C){i='<tr><td colspan="3"><div class="ui-timepicker-buttonpane ui-widget-content">';if(h)i+='<button type="button" class="ui-timepicker-now ui-state-default ui-corner-all"  data-timepicker-instance-id="#'+a.id.replace(/\\\\/g,
"\\")+'" >'+m+"</button>";if(o)i+='<button type="button" class="ui-timepicker-deselect ui-state-default ui-corner-all"  data-timepicker-instance-id="#'+a.id.replace(/\\\\/g,"\\")+'" >'+z+"</button>";if(w)i+='<button type="button" class="ui-timepicker-close ui-state-default ui-corner-all"  data-timepicker-instance-id="#'+a.id.replace(/\\\\/g,"\\")+'" >'+v+"</button>";f+=i+"</div></td></tr>"}f+="</table>";f+=b.browser.msie&&parseInt(b.browser.version,10)<7&&!a.inline?'<iframe src="javascript:false;" class="ui-timepicker-cover" frameborder="0"></iframe>':
"";return f},_updateMinuteDisplay:function(a){var c=this._generateHTMLMinutes(a);a.tpDiv.find("td.ui-timepicker-minutes").html(c);this._rebindDialogEvents(a)},_generateHTMLMinutes:function(a){var c,e,d="",f=this._get(a,"rows"),i=Array();e=this._get(a,"minutes");var l=null,j=0,s=this._get(a,"showMinutesLeadingZero")==true,A=this._get(a,"onMinuteShow"),r=this._get(a,"minuteText");if(!e.starts)e.starts=0;if(!e.ends)e.ends=59;for(c=e.starts;c<=e.ends;c+=e.interval)i.push(c);l=Math.round(i.length/f+0.49);
if(A&&A.apply(a.input?a.input[0]:null,[a.hours,a.minutes])==false)for(j=0;j<i.length;j+=1){c=i[j];if(A.apply(a.input?a.input[0]:null,[a.hours,c])){a.minutes=c;break}}d+='<div class="ui-timepicker-title ui-widget-header ui-helper-clearfix ui-corner-all">'+r+'</div><table class="ui-timepicker">';j=0;for(e=1;e<=f;e++){for(d+="<tr>";j<e*l;){c=i[j];A="";if(c!==undefined)A=c<10&&s?"0"+c.toString():c.toString();d+=this._generateHTMLMinuteCell(a,c,A);j++}d+="</tr>"}d+="</table>";return d},_generateHTMLHourCell:function(a,
c,e,d){var f=c;if(c>12&&e)f=c-12;if(f==0&&e)f=12;if(f<10&&d)f="0"+f;e="";e=true;d=this._get(a,"onHourShow");if(c==undefined)return e='<td><span class="ui-state-default ui-state-disabled">&nbsp;</span></td>';if(d)e=d.apply(a.input?a.input[0]:null,[c]);return e=e?'<td class="ui-timepicker-hour-cell" data-timepicker-instance-id="#'+a.id.replace(/\\\\/g,"\\")+'" data-hour="'+c.toString()+'"><a class="ui-state-default '+(c==a.hours?"ui-state-active":"")+'">'+f.toString()+"</a></td>":'<td><span class="ui-state-default ui-state-disabled '+
(c==a.hours?" ui-state-active ":" ")+'">'+f.toString()+"</span></td>"},_generateHTMLMinuteCell:function(a,c,e){var d="";d=true;var f=this._get(a,"onMinuteShow");if(f)d=f.apply(a.input?a.input[0]:null,[a.hours,c]);if(c==undefined)return d='<td><span class="ui-state-default ui-state-disabled">&nbsp;</span></td>';return d=d?'<td class="ui-timepicker-minute-cell" data-timepicker-instance-id="#'+a.id.replace(/\\\\/g,"\\")+'" data-minute="'+c.toString()+'" ><a class="ui-state-default '+(c==a.minutes?"ui-state-active":
"")+'" >'+e+"</a></td>":'<td><span class="ui-state-default ui-state-disabled" >'+e+"</span></td>"},_destroyTimepicker:function(a){var c=b(a),e=b.data(a,"timepicker");if(c.hasClass(this.markerClassName)){var d=a.nodeName.toLowerCase();b.removeData(a,"timepicker");if(d=="input"){e.append.remove();e.trigger.remove();c.removeClass(this.markerClassName).unbind("focus.timepicker",this._showTimepicker).unbind("click.timepicker",this._adjustZIndex)}else if(d=="div"||d=="span")c.removeClass(this.markerClassName).empty()}},
_enableTimepicker:function(a){var c=b(a),e=c.attr("id"),d=b.data(a,"timepicker");if(c.hasClass(this.markerClassName)){var f=a.nodeName.toLowerCase();if(f=="input"){a.disabled=false;a=this._get(d,"button");b(a).removeClass("ui-state-disabled").disabled=false;d.trigger.filter("button").each(function(){this.disabled=false}).end()}else if(f=="div"||f=="span"){d=c.children("."+this._inlineClass);d.children().removeClass("ui-state-disabled");d.find("button").each(function(){this.disabled=false})}this._disabledInputs=
b.map(this._disabledInputs,function(i){return i==e?null:i})}},_disableTimepicker:function(a){var c=b(a),e=b.data(a,"timepicker");if(c.hasClass(this.markerClassName)){var d=a.nodeName.toLowerCase();if(d=="input"){d=this._get(e,"button");b(d).addClass("ui-state-disabled").disabled=true;a.disabled=true;e.trigger.filter("button").each(function(){this.disabled=true}).end()}else if(d=="div"||d=="span"){e=c.children("."+this._inlineClass);e.children().addClass("ui-state-disabled");e.find("button").each(function(){this.disabled=
true})}this._disabledInputs=b.map(this._disabledInputs,function(f){return f==a?null:f});this._disabledInputs[this._disabledInputs.length]=c.attr("id")}},_isDisabledTimepicker:function(a){if(!a)return false;for(var c=0;c<this._disabledInputs.length;c++)if(this._disabledInputs[c]==a)return true;return false},_checkOffset:function(a,c,e){var d=a.tpDiv.outerWidth(),f=a.tpDiv.outerHeight(),i=a.input?a.input.outerWidth():0,l=a.input?a.input.outerHeight():0,j=document.documentElement.clientWidth+b(document).scrollLeft(),
s=document.documentElement.clientHeight+b(document).scrollTop();c.left-=this._get(a,"isRTL")?d-i:0;c.left-=e&&c.left==a.input.offset().left?b(document).scrollLeft():0;c.top-=e&&c.top==a.input.offset().top+l?b(document).scrollTop():0;c.left-=Math.min(c.left,c.left+d>j&&j>d?Math.abs(c.left+d-j):0);c.top-=Math.min(c.top,c.top+f>s&&s>f?Math.abs(f+l):0);return c},_findPos:function(a){for(var c=this._get(this._getInst(a),"isRTL");a&&(a.type=="hidden"||a.nodeType!=1);)a=a[c?"previousSibling":"nextSibling"];
a=b(a).offset();return[a.left,a.top]},_getBorders:function(a){var c=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(c(a.css("border-left-width"))),parseFloat(c(a.css("border-top-width")))]},_checkExternalClick:function(a){if(b.timepicker._curInst){a=b(a.target);a[0].id!=b.timepicker._mainDivId&&a.parents("#"+b.timepicker._mainDivId).length==0&&!a.hasClass(b.timepicker.markerClassName)&&!a.hasClass(b.timepicker._triggerClass)&&b.timepicker._timepickerShowing&&!(b.timepicker._inDialog&&
b.blockUI)&&b.timepicker._hideTimepicker()}},_hideTimepicker:function(a){var c=this._curInst;if(!(!c||a&&c!=b.data(a,"timepicker")))if(this._timepickerShowing){a=this._get(c,"showAnim");var e=this._get(c,"duration"),d=function(){b.timepicker._tidyDialog(c);this._curInst=null};b.effects&&b.effects[a]?c.tpDiv.hide(a,b.timepicker._get(c,"showOptions"),e,d):c.tpDiv[a=="slideDown"?"slideUp":a=="fadeIn"?"fadeOut":"hide"](a?e:null,d);a||d();this._timepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",
left:"0",top:"-100px"});if(b.blockUI){b.unblockUI();b("body").append(this.tpDiv)}}this._inDialog=false;if(a=this._get(c,"onClose"))a.apply(c.input?c.input[0]:null,[c.input?c.input.val():"",c])}},_tidyDialog:function(a){a.tpDiv.removeClass(this._dialogClass).unbind(".ui-timepicker")},_getInst:function(a){try{return b.data(a,"timepicker")}catch(c){throw"Missing instance data for this timepicker";}},_get:function(a,c){return a.settings[c]!==undefined?a.settings[c]:this._defaults[c]},_setTimeFromField:function(a){if(a.input.val()!=
a.lastVal){var c=this._get(a,"defaultTime");c=c=="now"?this._getCurrentTimeRounded(a):c;if(a.inline==false&&a.input.val()!="")c=a.input.val();if(c instanceof Date){a.hours=c.getHours();a.minutes=c.getMinutes()}else{var e=a.lastVal=c;if(c==""){a.hours=-1;a.minutes=-1}else{c=this.parseTime(a,e);a.hours=c.hours;a.minutes=c.minutes}}b.timepicker._updateTimepicker(a)}},_optionTimepicker:function(a,c,e){var d=this._getInst(a);if(arguments.length==2&&typeof c=="string")return c=="defaults"?b.extend({},b.timepicker._defaults):
d?c=="all"?b.extend({},d.settings):this._get(d,c):null;var f=c||{};if(typeof c=="string"){f={};f[c]=e}if(d){this._curInst==d&&this._hideTimepicker();t(d.settings,f);this._updateTimepicker(d)}},_setTimeTimepicker:function(a,c){if(a=this._getInst(a)){this._setTime(a,c);this._updateTimepicker(a);this._updateAlternate(a,c)}},_setTime:function(a,c,e){var d=a.hours,f=a.minutes;c=this.parseTime(a,c);a.hours=c.hours;a.minutes=c.minutes;if((d!=a.hours||f!=a.minuts)&&!e)a.input.trigger("change");this._updateTimepicker(a);
this._updateSelectedValue(a)},_getCurrentTimeRounded:function(){var a=new Date,c=a.getMinutes();c=Math.round(c/5)*5;a.setMinutes(c);return a},parseTime:function(a,c){var e={};e.hours=-1;e.minutes=-1;var d=this._get(a,"timeSeparator"),f=this._get(a,"amPmText"),i=this._get(a,"showHours"),l=this._get(a,"showMinutes"),j=this._get(a,"optionalMinutes");a=this._get(a,"showPeriod")==true;d=c.indexOf(d);if(d!=-1){e.hours=parseInt(c.substr(0,d),10);e.minutes=parseInt(c.substr(d+1),10)}else if(i&&(!l||j))e.hours=
parseInt(c,10);else if(!i&&l)e.minutes=parseInt(c,10);if(i){c=c.toUpperCase();if(e.hours<12&&a&&c.indexOf(f[1].toUpperCase())!=-1)e.hours+=12;if(e.hours==12&&a&&c.indexOf(f[0].toUpperCase())!=-1)e.hours=0}return e},selectNow:function(a){a=b(a.target).attr("data-timepicker-instance-id");a=this._getInst(b(a)[0]);var c=new Date;a.hours=c.getHours();a.minutes=c.getMinutes();this._updateSelectedValue(a);this._updateTimepicker(a);this._hideTimepicker()},deselectTime:function(a){a=b(a.target).attr("data-timepicker-instance-id");
a=this._getInst(b(a)[0]);a.hours=-1;a.minutes=-1;this._updateSelectedValue(a);this._hideTimepicker()},selectHours:function(a){var c=b(a.currentTarget),e=c.attr("data-timepicker-instance-id"),d=parseInt(c.attr("data-hour"));a=a.data.fromDoubleClick;e=b(e);var f=this._getInst(e[0]),i=this._get(f,"showMinutes")==true;if(b.timepicker._isDisabledTimepicker(e.attr("id")))return false;c.parents(".ui-timepicker-hours:first").find("a").removeClass("ui-state-active");c.children("a").addClass("ui-state-active");
f.hours=d;this._get(f,"onMinuteShow")&&this._updateMinuteDisplay(f);this._updateSelectedValue(f);f._hoursClicked=true;if(f._minutesClicked||a||i==false)b.timepicker._hideTimepicker();return false},selectMinutes:function(a){var c=b(a.currentTarget),e=c.attr("data-timepicker-instance-id"),d=parseInt(c.attr("data-minute"));a=a.data.fromDoubleClick;e=b(e);var f=this._getInst(e[0]),i=this._get(f,"showHours")==true;if(b.timepicker._isDisabledTimepicker(e.attr("id")))return false;c.parents(".ui-timepicker-minutes:first").find("a").removeClass("ui-state-active");
c.children("a").addClass("ui-state-active");f.minutes=d;this._updateSelectedValue(f);f._minutesClicked=true;if(f._hoursClicked||a||i==false){b.timepicker._hideTimepicker();return false}return false},_updateSelectedValue:function(a){var c=this._getParsedTime(a);if(a.input){a.input.val(c);a.input.trigger("change")}var e=this._get(a,"onSelect");if(e)e.apply(a.input?a.input[0]:null,[c,a]);this._updateAlternate(a,c);return c},_getParsedTime:function(a){if(a.hours==-1&&a.minutes==-1)return"";if(a.hours<
a.hours.starts||a.hours>a.hours.ends)a.hours=0;if(a.minutes<a.minutes.starts||a.minutes>a.minutes.ends)a.minutes=0;var c="",e=this._get(a,"showPeriod")==true,d=this._get(a,"showLeadingZero")==true,f=this._get(a,"showHours")==true,i=this._get(a,"showMinutes")==true,l=this._get(a,"optionalMinutes")==true,j=this._get(a,"amPmText"),s=a.hours?a.hours:0,A=a.minutes?a.minutes:0,r=s?s:0;s="";if(e){if(a.hours==0)r=12;if(a.hours<12)c=j[0];else{c=j[1];if(r>12)r-=12}}e=r.toString();if(d&&r<10)e="0"+e;d=A.toString();
if(A<10)d="0"+d;if(f)s+=e;if(f&&i&&(!l||d!=0))s+=this._get(a,"timeSeparator");if(i&&(!l||d!=0))s+=d;if(f)if(c.length>0)s+=this._get(a,"periodSeparator")+c;return s},_updateAlternate:function(a,c){(a=this._get(a,"altField"))&&b(a).each(function(e,d){b(d).val(c)})},_getTimeTimepicker:function(a){return this._getParsedTime(this._getInst(a))},_getHourTimepicker:function(a){a=this._getInst(a);if(a==undefined)return-1;return a.hours},_getMinuteTimepicker:function(a){a=this._getInst(a);if(a==undefined)return-1;
return a.minutes}});b.fn.timepicker=function(a){if(!b.timepicker.initialized){b(document).mousedown(b.timepicker._checkExternalClick).find("body").append(b.timepicker.tpDiv);b.timepicker.initialized=true}var c=Array.prototype.slice.call(arguments,1);if(typeof a=="string"&&(a=="getTime"||a=="getHour"||a=="getMinute"))return b.timepicker["_"+a+"Timepicker"].apply(b.timepicker,[this[0]].concat(c));if(a=="option"&&arguments.length==2&&typeof arguments[1]=="string")return b.timepicker["_"+a+"Timepicker"].apply(b.timepicker,
[this[0]].concat(c));return this.each(function(){typeof a=="string"?b.timepicker["_"+a+"Timepicker"].apply(b.timepicker,[this].concat(c)):b.timepicker._attachTimepicker(this,a)})};b.timepicker=new B;b.timepicker.initialized=false;b.timepicker.uuid=(new Date).getTime();b.timepicker.version="0.3.1";window["TP_jQuery_"+p]=b})(jQuery);
